dsl_version: 0.1.0
service:
  name: nova-novncproxy
  ports:
    - {{ nova.novncproxy_port }}
  containers:
    - name: nova-novncproxy
      image: nova-novncproxy
      daemon:
        command: nova-novncproxy --config-file /etc/nova/nova.conf
        files:
          - nova.conf
    # {% if security.tls.openstack.enabled %}
          - ca-cert
          - server-cert
          - server-key
    # {% endif %}
        dependencies:
          - nova-db-migrations
    # {% if security.tls.openstack.enabled %}
    - name: nginx
      image: nginx
      daemon:
        files:
          - upstreams
          - servers
          - server-cert
          - server-key
        command: nginx
    # {% endif %}
files:
  nova.conf:
    path: /etc/nova/nova.conf
    content: nova.conf.j2
    perm: "0600"
  # {% if security.tls.openstack.enabled %}
  servers:
    path: /etc/nginx/conf.d/servers.conf
    content: nginx-novncproxy.conf.j2
    perm: "0400"
  upstreams:
    path: /etc/nginx/conf.d/upstreams.conf
    content: upstreams.conf.j2
    perm: "0400"
  server-cert:
    path: /opt/ccp/etc/tls/server-cert.pem
    content: server-cert.pem.j2
    perm: "0400"
  server-key:
    path: /opt/ccp/etc/tls/server-key.pem
    content: server-key.pem.j2
    perm: "0400"
  ca-cert:
    path: /opt/ccp/etc/tls/ca.pem
    content: ca-cert.pem.j2
    perm: "0400"
  # {% endif %}
